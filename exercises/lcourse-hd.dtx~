% \iffalse
%% File: lcourse-hd.dtx by Arno Trautmann, mail: arno dot trautmann at gmx dot de
%<*internal>
\iffalse
%</internal>
%<*readme>
This is the readme file.
%</readme>
%<*internal>
\fi
\begingroup
%</internal>
%<*batchfile>
\input docstrip.tex
\keepsilent
\preamble
EXPERIMENTAL CODE

Do not distribute this file without also distributing the
source files specified above.

Do not distribute a modified version of this file under the same name.

\endpreamble
\postamble
Copyright 2008–2010 Arno Trautmann <arno.trautmann@gmx.de>

Distributed under the LaTeX Project Public License,
verson 1.3c or higher (your choice). The latest version of
this license is at: http://www.latex-project.org/lppl.txt

This work is "author-maintained" by Arno Trautmann

This work conists of this file lcourse-hd.dtx
         and the derived files lcourse-hd.cls
                               lcourse-hd.pdf

\endpostamble
\askforoverwritefalse

\generate{\file{lcourse-hd.cls}{\from{lcourse-hd.dtx}{lcourse-hd}}}
%</batchfile>
%<batchfile>\endbatchfile
%<*internal>
\generate{\file{lcourse-hd.ins}{\from{lcourse-hd.dtx}{batchfile}}}
\endgroup
%</internal>
%
%<*driver>
\documentclass[a4paper]{ltxdoc}
\usepackage{ifxetex,ifluatex}
\usepackage[english]{polyglossia}
\usepackage{
  expl3,
  todonotes,
  hyperref,
  lmodern,
  xltxtra
}

\hypersetup{%
  pdfborder= 0 0 0,
  colorlinks=true,
  linkcolor= blue,
  pdftitle=altTeX
}

\def\filedate{2010/01/09}
\def\fileversion{0.c}

\title{The \textsf{lcourse-hd} package}
\author{Arno L. Trautmann\thanks{arno.trautmann@gmx.de}}
\date{Version 0.c \filedate}

\EnableCrossrefs
\CodelineIndex
\RecordChanges

\usepackage{ifthen}

%\OnlyDescription
\begin{document}
\maketitle
\DocInput{lcourse-hd.dtx}
\end{document}
%</driver>
% 
% \fi
% \maketitle
% \begin{abstract}
% A small class to build working sheets for the tutorial of the course on \LaTeX\ in Heidelberg, 2009. The course is held by the author.
% \end{abstract}
% \section{Page layout}
% First, we define some keys for the layout – so we need |xkeyval|. Options are the number of the sheet etc. and whether the solutions should be printed or not.
%    \begin{macrocode}
\RequirePackage{xkeyval,marginnote}
\newif\ifsolution
\DeclareOptionX{ausgabe}[\today]{\def\ausgabe{#1}}
\DeclareOptionX{rückgabe}[XXX]{\def\rückgabe{#1}}
\DeclareOptionX{blatt}[XXX]{\def\blattnummer{#1}}
\DeclareOptionX{solution}{\solutiontrue}
\ProcessOptionsX
%    \end{macrocode}
% We use |scrartcl| for the layout, |scrpage2| for headings and footers. Maybe the |\input| will be implemented in a special way, so def a synonyme for it.
%    \begin{macrocode}
\LoadClass[headinclude,ngerman]{scrartcl}
\RequirePackage{
  amsmath,
  comment,
  moreverb,
  shortvrb,
  showexpl,
  totpages,
  xltxtra,
  ellipsis
}
\usepackage[ngerman]{babel}
\RequirePackage[svgnames]{xcolor}
\RequirePackage[ilines]{scrpage2}
\RequirePackage[top = 4cm,bottom = 3cm]{geometry}
\frenchspacing
\reversemarginpar
\let\exinput\input 

\setheadtopline{2pt}
\setheadsepline[text]{.7pt}
\setfootsepline{.7pt}

\ihead{\fontspec{Arno Pro} \rm Einführung in das\\ Textsatzsystem \LaTeX}
\chead{\fontspec{Arno Pro} Übungsblatt \blattnummer}
\ohead{\fontspec{Arno Pro} Ausgegeben: \ausgabe\\Abgabe: \rückgabe}
\ofoot{Seite \thepage /\ref{TotPages}}
\cfoot{}
\ifoot{\rm Heidelberg, Sommersemester 2009}
\pagestyle{scrheadings}
\setmainfont[Ligatures={Rare,Common}]{Arno Pro}
\AtBeginDocument{
  \MakeShortVerb{|}\vspace*{-8mm}\setcounter{section}{\blattnummer}
%    \end{macrocode}
% Setup for the \LaTeX-code in the solutions:
%    \begin{macrocode}
  \lstset{%
    backgroundcolor=\color[rgb]{.9 .9 .9},
    basicstyle=\ttfamily\small,
    breakindent=0em,
    breaklines=true,
    commentstyle=,
    keywordstyle=,
    identifierstyle=,
    captionpos=b,
    numbers=none,
    frame=tlbr,%shadowbox,
    pos=r,
    rframe={single},
    explpreset={numbers=none}
  }
}
%    \end{macrocode}
% \section{macros}
% Macro definitions for printing the exercises. We count the number of exercises for each sheet. So they will be numbered like 1.1, 1.2 for the first sheet, 2.1, 2.2 for the second and so on. This is not a nice solution, but the only one that works with the standard |\ref| commands.
% \begin{environment}{exercise}
%    \begin{macrocode}
\newcounter{excount}
\setcounter{excount}{1}

\define@key{exercise}{abgabe}[keine Abgabe erforderlich]{\def\abgabe{#1}}

\renewcommand*{\othersectionlevelsformat}[3]{Übung #3\autodot\enskip}
\newenvironment{exercise}[3][]
{
  \def\abgabe{}
  \setkeys{exercise}{#1}
  \def\scores{#3}
  \subsection{
%    Übung \blattnummer.\theexcount:
    #2
    \hfill
    \scores\ Punkte
  }
  \label{ex:\jobname}
  \begin{minipage}{1.0\textwidth}
}
{
  \end{minipage}\stepcounter{excount}\bigskip\par
  \textit{Abgabe:} \abgabe\bigskip
}
%    \end{macrocode}
% \end{environment}
% \begin{environment}{expertexercise}
% There will be some extra exercises for the \TeX{}perts. Here is their environment, with the well-known ”dangerous bend“-sign of the \TeX{}book:
%    \begin{macrocode}
\font\manual=manfnt
\reversemarginpar
\newenvironment{expertexercise}[2][]
{
  \begin{exercise}[#1]{#2}
  {\it keine}\vspace*{-.8cm}
  \marginnote{\manual\char127\quad}
  \vspace*{.8cm}
}
{
  \end{exercise}
}
%    \end{macrocode}
% \end{environment}
% \begin{environment}{solution}
% Finally, the solutions to the exercises:
%    \begin{macrocode}
\newenvironment{solutionenv}
{\subsection*{Lösung:}\begin{minipage}{\textwidth}}
{\end{minipage}}

\specialcomment{solution}{\ifsolution \begin{solutionenv}\fi}{\ifsolution \end{solutionenv}\fi}

\ifsolution \else \excludecomment{solution}\fi

\def\lcode{\bigskip\\\boxedverbatim}
\def\endlcode{\endboxedverbatim\bigskip\\}
\def\pkg#1{\textsf{#1}}
%    \end{macrocode}
% \end{environment}
% The exercises are stored in a folder for each sheet. We |\input| them automatically right with the following |def|:
%    \begin{macrocode}
\def\exinput#1{
  \input{Aufgaben_Übung\blattnummer/#1}
}
%    \end{macrocode}
% The well-known |itemize|-hack from the |lcourse-hd|-package, a bit shortened:
%    \begin{macrocode}
\def\outside{o}
\def\inside{i}
\let\insideitemizei\outside
\let\insideitemizeii\outside
\def\altenditemize{
  \if\altlastitem 1%
    \let\altlastitem0%
  \else%
    \end{itemize}%
    \let\insideitemizei\outside%
  \fi%
}

\begingroup
  \lccode`\~=`\^^M%
\lowercase{%
  \endgroup
  \def\makeenteractive{%
    \catcode`\^^M=\active
    \let~\altenditemize
}%
}

\catcode`\•13
\def•{%
  \ifx\insideitemizei\inside%
    \let\altlastitem1%
    \expandafter\item%
  \else%
    \begin{itemize}%
    \let\insideitemizei\inside%
    \let\altlastitem1%
    \makeenteractive%
    \expandafter\item%
  \fi
}
%    \end{macrocode}
% \Finale
\endinput